---
title: <font color = "purple"> **Brecha de genero** </font>
author: "Ester Sansegundo"
date: "8 de enero de 2021"
output: 
  html_document: 
    toc: True
    toc_depth: 5
    toc_float: 
      collapse: True
      smooth_scroll: true
    code_folding: hide
  
---
## <span style="color:purple"> Introducción </span>

El SEPE y el INE publican series temporales de datos con diferentes desagregaciones que facilitan la realización de análisis de las características que presentan los demandantes de empleo, con el objeto de obtener el perfil que caracteriza al colectivo. En estos datos se observa como la evolución de la demanda de empleo en España se ve afectada por una brecha de género que se acentúa por la influencia de diferentes variables.

Con estos datos realizaremos un análisis de los mismos con diferentes técnicas y herramientas, que nos proporcionaran información sobre cómo influyen determinadas variables en los demandantes de empleo. 

## <span style="color:purple"> Objetivos </span>

El objetivo principal de este estudio es determinar la brecha de género en el colectivo de demandantes de empleo y como se ve influenciada por diferentes variables como son la edad, la localización, los estudios y el tipo de contrato al que suelen optar. 

## <span style="color:purple"> Recursos </span>

### <span style = "color:purple"> Datos abiertos </span>

Para este análisis se han utilizado diferentes fuentes de datos.

* Datasets de los demandantes de empleo por municipio. [Estos conjuntos de datos](https://datos.gob.es/es/catalogo/ea0021425-demandantes-de-empleo-por-municipios) están disponibles en [datos.gob.es](https://datos.gob.es/). Se trata de varios conjuntos de datos que recogen una serie temporal mensual desde 2006 hasta 2020, del número de demandantes de empleo por municipios en España. Estos datos han sido publicados por el Servicio Público de Empleo Estatal (Ministerio de Trabajo y Economía Social).

* Datasets del gasto de prestaciones por desempleo por provincia. [Estos datasets](https://datos.gob.es/es/catalogo/ea0021425-gasto-en-prestaciones) están disponibles en [datos.gob.es](https://datos.gob.es/). Estos datos recogen una serie temporal mensual desde 2010 hasta 2020 desagregado por mes y provincias. Estos datos han sido publicados por el Servicio Público de Empleo Estatal (Ministerio de Trabajo y Economía Social). 

* Datasets de contratos registrados por municipios. [Este conjunto de datasets](https://datos.gob.es/es/catalogo/ea0021425-contratos-por-municipios) están publicados en [datos.gob.es](https://datos.gob.es/). Estos datos representan una serie temporal mensual desde 2006 hasta 2020 por municipio en España. Estos datos han sido publicados por el Servicio Público de Empleo Estatal (Ministerio de Trabajo y Economía Social).  

### <span style = "color:purple"> Herramientas </span>      

Para la realización de este documento (entorno de trabajo, programación y redacción del mismo) se ha utilizado [RStudio](https://rstudio.com/) con el complemento de [Markdown](https://daringfireball.net/projects/markdown/).

Para la creación de los gráficos interactivos se han usado las herramientas de [Elastic Stack](https://www.elastic.co/es/elastic-stack?ultron=B-Stack-Trials-EMEA-S-Exact&gambit=Elasticsearch-ELK&blade=adwords-s&hulk=cpc&Device=c&thor=elastic%20stack&gclid=Cj0KCQiA0fr_BRDaARIsAABw4Evg_ld47Q6u6eE89zQ3Jl1TPZqX1UG9xebZfyUBpo6Z7QX_fO4txgMaAuuAEALw_wcB) (Elasticsearch, Logstash y Kibana). 

## <span style="color:purple"> Tratamiento de datos </span>

###<span style="color:purple"> Instalación y carga de librerías </span>

Instalamos y cargamos las librerías necesarias para el tratamiento y análisis de los datos. 

```{r carga de librerías, warning = FALSE}
#Paquete para importar archivos de excel
if (!requireNamespace("readxl", quietly = TRUE)) {install.packages("readxl")}
library(readxl)

#Paquete para facilitar la manipulación y operaciones con data frames
if (!requireNamespace("dplyr", quietly = TRUE)) {install.packages("dplyr")}
library(dplyr)

#Paquete que facilita el trabajo con variables de tipo fecha
if (!requireNamespace("lubridate", quietly = TRUE)) {install.packages("lubridate")}
library(lubridate)

#Paquete que implementa la representación gráfica de los datos 
if (!requireNamespace("ggplot2", quietly = TRUE)) {install.packages("ggplot2")}
library(ggplot2)
```

### <span style="color:purple"> Carga y limpieza de datos </span>

####<span style="color:purple"> Carga de datasets </span>

Lo primero que vamos a hacer es cargar los conjuntos de datos desde la propia 
página web donde se encuentran.    

```{r carga de datos, warning = FALSE}
#Carga de datasets de demandantes de empleo por municipio desde 2006 hasta 2020.

Demandantes_empleo_2006 <-
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2006_csv.csv", 
          sep=";", skip = 1, header = T)

Demandantes_empleo_2007 <-
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2007_csv.csv", 
          sep=";", skip = 1, header = T)

Demandantes_empleo_2008 <-
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2008_csv.csv", 
          sep=";", skip = 1, header = T)

Demandantes_empleo_2009 <-
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2009_csv.csv", 
          sep=";", skip =1, header= T)

Demandantes_empleo_2010 <-
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2010_csv.csv", 
          sep=";", skip = 1, header = T)

Demandantes_empleo_2011 <-
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2011_csv.csv", 
          sep=";", skip = 1, header = T)

Demandantes_empleo_2012 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2012_csv.csv", 
          sep=";", skip = 1, header = T)

Demandantes_empleo_2014 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2014_csv.csv", 
          sep=";", skip = 1, header = T)

Demandantes_empleo_2015 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2015_csv.csv",
          sep=";", skip = 1, header = T)

Demandantes_empleo_2016 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2016_csv.csv",
          sep=";", skip = 1, header = T)

Demandantes_empleo_2017 <-
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2017_csv.csv", 
           sep=";", skip = 1, header = T)

Demandantes_empleo_2018 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2018_csv.csv", 
          sep=";", skip = 1, header = T)

Demandantes_empleo_2019 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2019_csv.csv",
          sep=";", skip = 1, header = T)

Demandantes_empleo_2020 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Dtes_empleo_por_municipios_2020_csv.csv",
          sep=";", skip = 1, header = T)


#Cargamos los datasets de gasto en prestaciones por desempleo por provincia desde 2010 hasta 2020 

gasto_2010 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Gastos_Prestaciones_2010_csv.csv", 
           sep=";", skip = 1, header = T)

gasto_2011 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Gastos_Prestaciones_2011_csv.csv",
           sep=";", skip = 1, header = T)

gasto_2012 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Gastos_Prestaciones_2012_csv.csv", 
           sep=";", skip = 1, header = T)

gasto_2014 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Gastos_Prestaciones_2014_csv.csv", 
           sep=";", skip = 1, header = T)

gasto_2015 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Gastos_Prestaciones_2015_csv.csv", 
           sep=";", skip = 1, header = T)

gasto_2016 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Gastos_Prestaciones_2016_csv.csv", 
           sep=";", skip = 1, header = T)

gasto_2017 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Gastos_Prestaciones_2017_csv.csv", 
           sep=";", skip = 1, header = T)

gasto_2018 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Gastos_Prestaciones_2018_csv.csv",
           sep=";", skip = 1, header = T)

gasto_2019 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Gastos_Prestaciones_2019_csv.csv", 
           sep=";", skip = 1, header = T)

gasto_2020 <- 
  read.csv("https://sede.sepe.gob.es/es/portaltrabaja/resources/sede/datos_abiertos/datos/Gastos_Prestaciones_2020_csv.csv",
           sep=";", skip = 1, header = T)

```

En los conjuntos de datos, el año 2013 en formato CSV no está completo, por tanto exportaremos estos datasets en 
formato xls. Como xls es un formato difícil de tratar, vamos
a descargar los datasets en nuestra carpeta de trabajo, para seguidamente cargarlos en RStudio.    

``` {r descargar 2013, warning = FALSE}
#Cargamos los datasets de demandantes de empleo por municipio para el primer y 
#segundo semestre de 2013

Demandantes_empleo_2013_1S <-
  read_excel("Dtes_empleo_por_municipios_primer_semestre_2013_xls.xls", 
                                         skip = 1, col_names = TRUE)

Demandantes_empleo_2013_2S <- read_excel("Dtes_empleo_por_municipios_segundo_semestre_2013_xls.xls", 
                                         skip = 1, col_names = TRUE)

#Unimos ambos datasets 

Demandantes_empleo_2013 <- rbind(Demandantes_empleo_2013_1S, 
                                 Demandantes_empleo_2013_2S)

#Cargamos el dataset de gasto en prestaciones por desempleo por provincia en 2013

gasto_2013<- read_excel("Gastos_Prestaciones_2013_xls.xls", 
                        skip = 1, col_names = TRUE)
```

Cuando cargamos los datos en formato xls, se cargan en tipo "tibble". Para poder trabajar con ellos al igual que con las otros datasets (que se cargan en tipo "data.frame"), los transformamos a "data.frame". 

``` {r , warning = FALSE}
#Dataset de demandantes de empleo en 2013
class(Demandantes_empleo_2013)
Demandantes_empleo_2013 <- as.data.frame(Demandantes_empleo_2013)
class(Demandantes_empleo_2013)

#Dataset de gasto en prestaciones por desempleo en 2013
class (gasto_2013)
gasto_2013 <- as.data.frame(gasto_2013)
class(gasto_2013)
```

Una vez que tenemos todas los datasets que nos interesan los unimos en un único conjunto de datos. 

Al cargar los datos en dos formatos diferentes (csv y xls), aunque las variables sean las mismas, RStudio interpreta los nombres de estas de manera diferente. Para unir todos los conjuntos de datos, sus variables deben presentar el mismo nombre. 

Como sabemos que los datasets presentan las mismas variables, haremos coincidir los nombres de estas en todos los datasets. 

```{r Unir datasets, warning = FALSE}
#Cambio de nombre a las variables del dataset de demandantes de empleo de 2013
identical(names(Demandantes_empleo_2006), names(Demandantes_empleo_2013))

names(Demandantes_empleo_2013) <- names(Demandantes_empleo_2006)

#Unión de los datasets de demandantes de empleo
Datos_desempleo <- rbind(Demandantes_empleo_2006, Demandantes_empleo_2007,
                         Demandantes_empleo_2008, Demandantes_empleo_2009,
                         Demandantes_empleo_2010, Demandantes_empleo_2011,
                         Demandantes_empleo_2012, Demandantes_empleo_2014,
                         Demandantes_empleo_2015, Demandantes_empleo_2016,
                         Demandantes_empleo_2017, Demandantes_empleo_2018,
                         Demandantes_empleo_2019, Demandantes_empleo_2020,
                         Demandantes_empleo_2013) 

#Previsualización del dataset de demandantes de empleo 
knitr::kable(head(Datos_desempleo))

#Cambio de nombre a las variables del dataset de gasto en prestaciones por desempleo de 2013

identical(names(gasto_2010), names(gasto_2013))

names(gasto_2013) <- names(gasto_2010)

#Unión de los datasets de gasto en prestaciones por desempleo
gasto_desempleo <- rbind(gasto_2010, gasto_2011, gasto_2012, gasto_2014,
                         gasto_2015,gasto_2016, gasto_2017, gasto_2018,
                         gasto_2019, gasto_2020)

#Previsualización del dataset de gasto en prestaciones por desempleo 
knitr::kable(head(gasto_desempleo))
```

####<span style="color:purple"> Transformación de variables </span>

Cuando tenemos el dataset que nos interesa, debemos evaluar el tipo de variables que presenta y si fuera necesario transformarlas.  

```{r Transformar variables, warning = FALSE}
#Dataset de demandantes de empleo
knitr::kable(str(Datos_desempleo))

#Transformamos la variable de "código. mes" en un formato compatible para ser reconocido como fecha.

Datos_desempleo$Código.mes <- as.factor(Datos_desempleo$Código.mes)
knitr::kable(str(Datos_desempleo$Código.mes))
str(Datos_desempleo$Código.mes)

Datos_desempleo$Código.mes <- parse_date_time(Datos_desempleo$Código.mes,
                                              (c("200601", "ym")), 
                                              truncated = 3)
str(Datos_desempleo$Código.mes)

Datos_desempleo$Código.mes <- as.factor(Datos_desempleo$Código.mes)
str(Datos_desempleo$Código.mes)

#Dataset de gasto en prestaciones por desempleo 

str(gasto_desempleo)

#Transformamos la variable del código mes en un formato compatible para ser reconocido como una fecha.
gasto_desempleo$Código.mes <- as.factor(gasto_desempleo$Código.mes)
str(gasto_desempleo$Código.mes)

gasto_desempleo$Código.mes <- parse_date_time(gasto_desempleo$Código.mes, 
                                              (c("200601", "ym")),
                                              truncated = 3)
str(gasto_desempleo$Código.mes)

gasto_desempleo$Código.mes <- as.factor(gasto_desempleo$Código.mes)
str(gasto_desempleo$Código.mes)

#Transformamos algunas de las variables que RStudio ha interpretado de tipo "character", pero son de tipo "numeric"
gasto_desempleo$Gasto.Prestación.Contributiva <-
  as.numeric(gasto_desempleo$Gasto.Prestación.Contributiva)
str(gasto_desempleo$Gasto.Prestación.Contributiva)

gasto_desempleo$Gasto.Total.Prestación <- 
  as.numeric(gasto_desempleo$Gasto.Total.Prestación)
str(gasto_desempleo$Gasto.Total.Prestación)

gasto_desempleo$Gasto.Subsidio.Desempleo <-
  as.numeric(gasto_desempleo$Gasto.Subsidio.Desempleo)
str(gasto_desempleo$Gasto.Subsidio.Desempleo)

gasto_desempleo$Gasto.Renta.Activa.Inserción <- 
  as.numeric(gasto_desempleo$Gasto.Renta.Activa.Inserción)
str(gasto_desempleo$Gasto.Renta.Activa.Inserción)

gasto_desempleo$Gasto.Subsidio.Eventuales.Agrarios <- 
  as.numeric(gasto_desempleo$Gasto.Subsidio.Eventuales.Agrarios)
str(gasto_desempleo$Gasto.Subsidio.Eventuales.Agrarios)
```

####<span style="color:purple"> Resumen del dataset </span>

Una vez que tenemos las variables en un formato adecuado para su análisis, 
realizamos un resumen de las varaibles que nos interesan en ambos datasets. 

```{r resumen de las variables que presenta el dataset, warning = FALSE}
#Resumen de variables del dataset de número de demandantes de empleo 
knitr::kable(summary (Datos_desempleo[,c(-2,-3,-4,-7)]))

#Resumen de las variables del dataset de gasto en prestaciones por desempleo.
knitr::kable(summary (gasto_desempleo[,c(-2,-3,-4,-7)]))

```

####<span style="color:purple"> Detección y tratamiento de datos perdido </span>

También debemos analizar si el dataset presenta datos perdidos (NAs). 

La función que aplicaremos posteriormente nos muestra un resultado booleano (TRUE o FALSE). Si resultado es "TRUE", nos indica que existen NAs dentro del dataset, pero no nos indica cuantos, ni su posición. Si el resultado es "FALSE", el dataset no presenta valores perdidos. 

```{r detección de NAs, warning = FALSE}
#Dataset de demandantes de empleo
any(is.na(Datos_desempleo))

#Dataset de gasto en prestaciones por desempleo
any(is.na(gasto_desempleo))

#En este caso el resultado es "TRUE" por tanto procedemos a eliminamos las filas que presenten NAs en el dataset de gasto en prestaciones por desempleo, ya que no tenemos opción de detectar el por qué de esos datos perdidos. 
gasto_desempleo <- na.omit(gasto_desempleo)

any(is.na(gasto_desempleo))
summary(gasto_desempleo)
```


####<span style="color:purple"> Creación de un nuevo dataset </span> 

Una vez que tenemos los dataset limpios, para agilizar las visualizaciones,
el conjunto de datos de los demandantes de empleo, le dividiremos en dos datasets, uno que presente los datos de todos los municipios a lo largo de los años (dataset de datos_desempleo) y otro en cual agruparemos los datos de desempleo en función de las provincias. 
El dataset de gasto de prestaciones por desempleo, como ya lo tenemos seleccionado por provincias, lo dejaremos como está. 

```{r creación de nuevo dataset, warning = FALSE}

#Realizamos un group by, agruparemos las variables numericas que nos interesen, en función de varias variables categóricas
desempleados_provincia <- Datos_desempleo %>% 
  group_by(Código.mes, Comunidad.Autónoma, Provincia) %>%
  summarise(total.Dtes.Empleo = (sum(total.Dtes.Empleo)), 
            Dtes.Empleo.hombre.edad...25 = (sum(Dtes.Empleo.hombre.edad...25)),
            Dtes.Empleo.hombre.edad.25..45 = (sum(Dtes.Empleo.hombre.edad.25..45)), 
            Dtes.Empleo.hombre.edad...45 = (sum(Dtes.Empleo.hombre.edad...45)),
            Dtes.Empleo.mujer.edad...25 = (sum(Dtes.Empleo.mujer.edad...25)),
            Dtes.Empleo.mujer.edad.25..45 = (sum(Dtes.Empleo.mujer.edad.25..45)),
            Dtes.Empleo.mujer.edad...45 = (sum(Dtes.Empleo.mujer.edad...45)))

knitr::kable(head(desempleados_provincia))
```

####<span style="color:purple"> Guardar los datasets </span> 

Una vez que tenemos los datasets con las variables que necesitamos para los análisis y las visualizaciones, los guardaremos en la carpeta que nosotros decidamos para poder usarlo en otras herramientas o para realizar análisis posteriores. Lo guardaremos en formato csv UTF8 (Formato de Transformación Unicode) para que los caracteres sean identificados de manera correcta por cualquier herramienta.  

```{r guardar el nuevo dataset, warning = FALSE}
#Dataset de demandantes de empleo por provincia desde 2006 hasta 2020. 

write.csv(desempleados_provincia,
          file="Desempleados_provincia_UTF8.csv",
          fileEncoding= "UTF-8")

#Dataset de gasto en prestaciones por  desempleo por provincia desde 2010 hasta 2020.

write.csv(gasto_desempleo, file="Gasto_desempleo_UTF8.csv", fileEncoding= "UTF-8")
```

### <span style="color:purple"> Comparativa entre gasto en prestaciones por desempleo y el número de desempleados por provincia </span>

Para poder realizar una comparativa entre el número de demandantes de empleo y el gasto que se invierte en cada uno de ellos en función de la provincia, realizaremos un merge de ambos datasets.Las variables de unión serán "Código.mes", "Provincia" y "Comunidad.Autónoma", que están presente en ambos datasets. 

```{r unión de los datasets, warning = FALSE}
knitr::kable(head(desempleados_provincia))
knitr::kable(head(gasto_desempleo))
gasto_por_desempleado <- merge(x = desempleados_provincia, y = gasto_desempleo , 
                               by = c("Código.mes", "Provincia", 
                                      "Comunidad.Autónoma"))

knitr::kable(head(gasto_por_desempleado))
str(gasto_por_desempleado)
```

Las variables de "Provincia" y Comunidad.Autónoma" son de tipo "character", pero nos interesa transformarlas en factores, de tal manera que podamos agrupar el dataset en función de esos factores.

```{r transformación de dos varibles, warning = FALSE}
gasto_por_desempleado$Provincia <- as.factor(gasto_por_desempleado$Provincia)
str(gasto_por_desempleado$Provincia)

gasto_por_desempleado$Comunidad.Autónoma <- as.factor(gasto_por_desempleado$Comunidad.Autónoma)
str(gasto_por_desempleado$Comunidad.Autónoma)
```

#### Coeficientes de correlación

Queremos realizar una compartiva entre dos variables numéricas, el número de demandantes de empleo ("total.Dtes.Empleo") y el gasto total en prestaciones por desempleo ("Gasto.Total.Prestacion"), para saber si existe una relación entre ambas. 

Calculamos el [coeficiente de correlación de Pearson](https://es.wikipedia.org/wiki/Coeficiente_de_correlaci%C3%B3n_de_Pearson) entre las variables regresoras.  

```{r Correlación de Pearson, warning = FALSE}
cor (gasto_por_desempleado$total.Dtes.Empleo, 
     gasto_por_desempleado$Gasto.Total.Prestación)

plot(gasto_por_desempleado [,c(15,4)], xlab = "Gasto por desempleo", 
     ylab = "Demandantes de empleo", main = "Matriz de dispersión")
```
Analizando el resultado, podemos determinar que existe una alta correlación entre ambas variables
 
#### Realización del modelo

Estamos trabajando con dos variables continuas, el número de demandantes de empleo ("total.Dtes.Empleo") y el gasto total en prestaciones por desempleo ("Gasto.Total.Prestacion"). 

Antes de realizar el modelo, debemos determinar si la variable respues ("Gasto.Total.Prestacion"), sigue una distribución normal. Si no es así debemos determinar que distribución sigue para aplicarla al modelo. 

Realizamos el [test Shapiro-Wilk](https://es.wikipedia.org/wiki/Test_de_Shapiro%E2%80%93Wilk) de normalidad. Si la distribución es normal, el p-valor debe ser mayor que el nivel de alfa (alfa = 0,05). 

```{r modelo, warning = FALSE}
install.packages("dlookr")
library(dlookr)

normality(gasto_por_desempleado, "Gasto.Total.Prestación")
plot_normality(gasto_por_desempleado, "Gasto.Total.Prestación")
```

Como hemos visto tanto en el test de Shapiro-Wilk, como en el histograma, los datos no siguen una distribución normal, siguen una [distribución Gamma](https://es.wikipedia.org/wiki/Distribuci%C3%B3n_gamma). 

Una vez que hemos detectado que tipo de distribución que sigue la variable respuesta, procedemos a realizar el modelo. En este caso es un [Modelo Lineal Generalizado (GLM)](https://es.wikipedia.org/wiki/Modelo_lineal_generalizado).

```{r modelo, warning = FALSE}
modelo_gamma <- glm((Gasto.Total.Prestación ~ total.Dtes.Empleo), 
              family = Gamma(link="identity"),
              data= gasto_por_desempleado)

```
 
Una vez que hemos realizado el modelo exploremos los resultados 

```{r modelo resultados, warning = FALSE}
summary(modelo_gamma)
print(modelo_gamma)
anova(modelo_gamma)
```


## <span style="color:purple"> Creación de nuevas variables </span> 

Una información que podria interesarnos y darnos mucha información, es el gasto medio que presenta cada una de las provincias por cada demandante de empleo. Para ello vamos a crear una nueva variable con dos variables presentres en el dataset con lo que estamos trabajando. 

```{r creación de una nueva varaible, warning = FALSE}
gasto_por_desempleado$gasto_desempleado <-
  (1000 * (gasto_por_desempleado$Gasto.Total.Prestación/
     gasto_por_desempleado$total.Dtes.Empleo))
View(gasto_por_desempleado)
```

Vamos a guardar este nuevo dataset con esta nueva variable, para poder utilizarlo con otras herramientas de visualización. 

```{r guardar nuevo dataset, warning = FALSE}
write.csv(gasto_por_desempleado,
          file="gasto_por_desempleado_UTF8.csv",
          fileEncoding= "UTF-8")
```